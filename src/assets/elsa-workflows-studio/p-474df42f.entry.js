import{r as t,c as e,h as s,H as i}from"./p-d44d1ddb.js";import{i as a}from"./p-1c810ec6.js";import{a as n}from"./p-25ed19bb.js";import{E as o}from"./p-f90ae5bc.js";import{e as l}from"./p-d17a08e5.js";import{a as r}from"./p-bdae1cb5.js";import"./p-4bdcf3f8.js";import{s as c}from"./p-c550dea5.js";import{T as h}from"./p-89475ce8.js";import{T as d}from"./p-151ebb97.js";import{W as u}from"./p-dc36c952.js";import{r as p}from"./p-dfca8bd9.js";import{l as f}from"./p-6a489817.js";import"./p-7a36e608.js";import"./p-83f217d4.js";import"./p-e47f7c7d.js";import"./p-a3b5bd35.js";import"./p-80de33dc.js";const w={en:{default:{Publishing:"Publishing...",Published:"Published",ActivityContextMenu:{Edit:"Edit",Delete:"Delete"},ConnectionContextMenu:{Paste:"Paste"}}},"nl-NL":{default:{Publishing:"Publiceren...",Published:"Gepubliceerd",ActivityContextMenu:{Edit:"Bewerken",Delete:"Verwijderen"},ConnectionContextMenu:{Paste:"Plakken"}}}},y=class{constructor(s){t(this,s),this.workflowSaved=e(this,"workflowSaved",7),this.activityContextMenuState={shown:!1,x:0,y:0,activity:null},this.connectionContextMenuState={shown:!1,x:0,y:0,activity:null},this.t=t=>this.i18next.t(t),this.onUpdateWorkflowSettings=async t=>{this.updateWorkflowDefinition(t),await this.saveWorkflowInternal(this.workflowModel)}}async getServerUrl(){return this.serverUrl}async getWorkflowDefinitionId(){return this.workflowDefinition.definitionId}async exportWorkflow(){const t=await r(this.serverUrl),e=this.workflowDefinition,s={version:e.version},i=await t.workflowDefinitionsApi.export(e.definitionId,s);var a;a={contentType:"application/json",fileName:i.fileName},function(t,e){const s=document.createElement("a");s.href=t,s.download=null!=e.fileName?e.fileName:"",s.click(),s.remove()}(window.URL.createObjectURL(i.data),a)}async importWorkflow(t){const e=await r(this.serverUrl);this.importing=!0,this.imported=!1,this.networkError=null;try{const s=await e.workflowDefinitionsApi.import(this.workflowDefinition.definitionId,t);this.workflowDefinition=s,this.workflowModel=this.mapWorkflowModel(s),this.updateUrl(s.definitionId),this.importing=!1,this.imported=!0,setTimeout((()=>this.imported=!1),500),await l.emit(o.WorkflowImported,this,this.workflowDefinition)}catch(t){console.error(t),this.importing=!1,this.imported=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),1e4)}}async workflowDefinitionIdChangedHandler(t){const e=t;let s=y.createWorkflowDefinition();s.definitionId=e;const i=await r(this.serverUrl);if(e&&e.length>0)try{s=await i.workflowDefinitionsApi.getByDefinitionAndVersion(e,{isLatest:!0})}catch(t){console.warn("The specified workflow definition does not exist. Creating a new one.")}this.updateWorkflowDefinition(s)}async serverUrlChangedHandler(t){t&&t.length>0&&(await this.loadActivityDescriptors(),await this.loadWorkflowStorageDescriptors())}async monacoLibPathChangedHandler(t){c.monacoLibPath=t}async workflowChangedHandler(t){const e=t.detail;await this.saveWorkflowInternal(e)}async componentWillLoad(){this.i18next=await f(this.culture,w),await this.serverUrlChangedHandler(this.serverUrl),await this.workflowDefinitionIdChangedHandler(this.workflowDefinitionId),await this.monacoLibPathChangedHandler(this.monacoLibPath)}async componentDidLoad(){this.designer||(this.designer=this.el.querySelector("elsa-designer-tree"),this.designer.model=this.workflowModel)}connectedCallback(){l.on(o.UpdateWorkflowSettings,this.onUpdateWorkflowSettings)}disconnectedCallback(){l.detach(o.UpdateWorkflowSettings,this.onUpdateWorkflowSettings)}async loadActivityDescriptors(){const t=await r(this.serverUrl);c.activityDescriptors=await t.activitiesApi.list()}async loadWorkflowStorageDescriptors(){const t=await r(this.serverUrl);c.workflowStorageDescriptors=await t.workflowStorageProvidersApi.list()}updateWorkflowDefinition(t){this.workflowDefinition=t,this.workflowModel=this.mapWorkflowModel(t)}async publishWorkflow(){this.publishing=!0,await this.saveWorkflow(!0),this.publishing=!1,await l.emit(o.WorkflowPublished,this,this.workflowDefinition)}async unPublishWorkflow(){this.unPublishing=!0,await this.unpublishWorkflow(),this.unPublishing=!1,await l.emit(o.WorkflowRetracted,this,this.workflowDefinition)}async saveWorkflow(t){await this.saveWorkflowInternal(null,t)}async saveWorkflowInternal(t,e){if(!this.serverUrl||0==this.serverUrl.length)return;t=t||this.workflowModel;const s=await r(this.serverUrl);let i=this.workflowDefinition;const a=void 0===i.definitionId&&void 0===this.workflowDefinitionId,n={workflowDefinitionId:i.definitionId||this.workflowDefinitionId,contextOptions:i.contextOptions,deleteCompletedInstances:i.deleteCompletedInstances,description:i.description,displayName:i.displayName,isSingleton:i.isSingleton,name:i.name,tag:i.tag,channel:i.channel,persistenceBehavior:i.persistenceBehavior,publish:e||!1,variables:i.variables,activities:t.activities.map((t=>({activityId:t.activityId,type:t.type,name:t.name,displayName:t.displayName,description:t.description,persistWorkflow:t.persistWorkflow,loadWorkflowContext:t.loadWorkflowContext,saveWorkflowContext:t.saveWorkflowContext,properties:t.properties,propertyStorageProviders:t.propertyStorageProviders}))),connections:t.connections.map((t=>({sourceActivityId:t.sourceId,targetActivityId:t.targetId,outcome:t.outcome})))};this.saving=!e,this.publishing=e;try{console.debug("Saving workflow..."),i=await s.workflowDefinitionsApi.save(n),this.workflowDefinition=i,this.workflowModel=this.mapWorkflowModel(i),this.saving=!1,this.saved=!e,this.publishing=!1,setTimeout((()=>this.saved=!1),500),this.workflowSaved.emit(i),a&&this.updateUrl(i.definitionId)}catch(t){console.error(t),this.saving=!1,this.saved=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),1e4)}}async unpublishWorkflow(){const t=await r(this.serverUrl),e=this.workflowDefinition.definitionId;this.unPublishing=!0;try{this.workflowDefinition=await t.workflowDefinitionsApi.retract(e),this.unPublishing=!1,this.unPublished=!0,setTimeout((()=>this.unPublished=!1),500)}catch(t){console.error(t),this.unPublishing=!1,this.unPublished=!1,this.networkError=t.message,setTimeout((()=>this.networkError=null),2e3)}}updateUrl(t){this.history.push(`/workflow-definitions/${t}`,{})}mapWorkflowModel(t){return{activities:t.activities.map(this.mapActivityModel),connections:t.connections.map(this.mapConnectionModel),persistenceBehavior:t.persistenceBehavior}}mapActivityModel(t){const e=c.activityDescriptors.find((e=>e.type==t.type));return{activityId:t.activityId,description:t.description,displayName:t.displayName,name:t.name,type:t.type,properties:t.properties,outcomes:[...e?e.outcomes:["Done"]],persistWorkflow:t.persistWorkflow,saveWorkflowContext:t.saveWorkflowContext,loadWorkflowContext:t.loadWorkflowContext,propertyStorageProviders:t.propertyStorageProviders}}mapConnectionModel(t){return{sourceId:t.sourceActivityId,targetId:t.targetActivityId,outcome:t.outcome}}handleContextMenuChange(t){this.activityContextMenuState=t}handleConnectionContextMenuChange(t){this.connectionContextMenuState=t}async onShowWorkflowSettingsClick(){await l.emit(o.ShowWorkflowSettings)}async onPublishClicked(){await this.publishWorkflow()}async onUnPublishClicked(){await this.unPublishWorkflow()}async onExportClicked(){await this.exportWorkflow()}async onImportClicked(t){await this.importWorkflow(t)}async onDeleteActivityClick(t){t.preventDefault(),await this.designer.removeActivity(this.activityContextMenuState.activity),this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null}),await l.emit(o.HideModalDialog)}async onEditActivityClick(t){t.preventDefault(),await this.designer.showActivityEditor(this.activityContextMenuState.activity,!0),this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null})}async onPasteActivityClick(t){t.preventDefault();let e=this.connectionContextMenuState.activity;await l.emit(o.PasteActivity,this,e),this.handleConnectionContextMenuChange({x:0,y:0,shown:!1,activity:null})}onActivityContextMenuButtonClicked(t){this.activityContextMenuState=t.detail}onConnectionContextMenuButtonClicked(t){this.connectionContextMenuState=t.detail}render(){return s(i,{class:"elsa-flex elsa-flex-col elsa-w-full",ref:t=>this.el=t},s(h.Provider,{state:{serverUrl:this.serverUrl,workflowDefinitionId:this.workflowDefinition.definitionId}},this.renderCanvas(),this.renderActivityPicker(),this.renderActivityEditor()))}renderCanvas(){return s("div",{class:"elsa-flex-1 elsa-flex elsa-relative"},s("elsa-designer-tree",{model:this.workflowModel,mode:u.Edit,activityContextMenuButton:()=>'<div class="context-menu-wrapper elsa-flex-shrink-0">\n            <button aria-haspopup="true"\n                    class="elsa-w-8 elsa-h-8 elsa-inline-flex elsa-items-center elsa-justify-center elsa-text-gray-400 elsa-rounded-full elsa-bg-transparent hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-text-gray-500 focus:elsa-bg-gray-100 elsa-transition elsa-ease-in-out elsa-duration-150">\n              <svg class="elsa-h-6 elsa-w-6 elsa-text-gray-400" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"\n                   stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n                <path stroke="none" d="M0 0h24v24H0z"/>\n                <circle cx="5" cy="12" r="1"/>\n                <circle cx="12" cy="12" r="1"/>\n                <circle cx="19" cy="12" r="1"/>\n              </svg>\n            </button>\n          </div>',onActivityContextMenuButtonClicked:t=>this.onActivityContextMenuButtonClicked(t),onConnectionContextMenuButtonClicked:t=>this.onConnectionContextMenuButtonClicked(t),activityContextMenu:this.activityContextMenuState,enableMultipleConnectionsFromSingleSource:!1,class:"elsa-flex-1",ref:t=>this.designer=t}),this.renderPropertiesPanel(),this.renderWorkflowSettingsButton(),this.renderActivityContextMenu(),this.renderConnectionContextMenu(),s("elsa-workflow-settings-modal",{workflowDefinition:this.workflowDefinition}),s("elsa-workflow-definition-editor-notifications",null),s("div",{class:"elsa-fixed elsa-bottom-10 elsa-right-12"},s("div",{class:"elsa-flex elsa-items-center elsa-space-x-4"},this.renderSavingIndicator(),this.renderNetworkError(),this.renderPublishButton())))}renderActivityContextMenu(){const t=this.t;return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.activityContextMenuState.shown?"":"hidden")+" context-menu elsa-z-10 elsa-mx-3 elsa-w-48 elsa-mt-1 elsa-rounded-md elsa-shadow-lg elsa-fixed",style:{left:`${this.activityContextMenuState.x}px`,top:`${this.activityContextMenuState.y}px`},ref:t=>p(this,t,(()=>{this.handleContextMenuChange({x:0,y:0,shown:!1,activity:null})}))},s("div",{class:"elsa-rounded-md elsa-bg-white elsa-shadow-xs",role:"menu","aria-orientation":"vertical","aria-labelledby":"pinned-project-options-menu-0"},s("div",{class:"elsa-py-1"},s("a",{onClick:t=>this.onEditActivityClick(t),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},t("ActivityContextMenu.Edit"))),s("div",{class:"elsa-border-t elsa-border-gray-100"}),s("div",{class:"elsa-py-1"},s("a",{onClick:t=>this.onDeleteActivityClick(t),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},t("ActivityContextMenu.Delete")))))}renderConnectionContextMenu(){return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.connectionContextMenuState.shown?"":"hidden")+" context-menu elsa-z-10 elsa-mx-3 elsa-w-48 elsa-mt-1 elsa-rounded-md elsa-shadow-lg elsa-absolute",style:{left:`${this.connectionContextMenuState.x}px`,top:this.connectionContextMenuState.y-64+"px"},ref:t=>p(this,t,(()=>{this.handleConnectionContextMenuChange({x:0,y:0,shown:!1,activity:null})}))},s("div",{class:"elsa-rounded-md elsa-bg-white elsa-shadow-xs",role:"menu","aria-orientation":"vertical","aria-labelledby":"pinned-project-options-menu-0"},s("div",{class:"elsa-py-1"},s("a",{onClick:t=>this.onPasteActivityClick(t),href:"#",class:"elsa-block elsa-px-4 elsa-py-2 elsa-text-sm elsa-leading-5 elsa-text-gray-700 hover:elsa-bg-gray-100 hover:elsa-text-gray-900 focus:elsa-outline-none focus:elsa-bg-gray-100 focus:elsa-text-gray-900",role:"menuitem"},(0,this.t)("ConnectionContextMenu.Paste")))))}renderActivityPicker(){return s("elsa-activity-picker-modal",null)}renderActivityEditor(){return s("elsa-activity-editor-modal",{culture:this.culture})}renderWorkflowSettingsButton(){return s("button",{onClick:()=>this.onShowWorkflowSettingsClick(),type:"button",class:"workflow-settings-button elsa-fixed elsa-top-20 elsa-right-12 elsa-inline-flex elsa-items-center elsa-p-2 elsa-rounded-full elsa-border elsa-border-transparent elsa-bg-white shadow elsa-text-gray-400 hover:elsa-text-blue-500 focus:elsa-text-blue-500 hover:elsa-ring-2 hover:elsa-ring-offset-2 hover:elsa-ring-blue-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",class:"elsa-h-8 elsa-w-8"},s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})))}renderWorkflowSettingsModal(){}renderSavingIndicator(){if(this.publishing)return;const t=this.t,e=this.unPublishing?t("Unpublishing..."):this.unPublished?t("Unpublished"):this.saving?"Saving...":this.saved?"Saved":this.importing?"Importing...":this.imported?"Imported":null;return e?s("div",null,s("span",{class:"elsa-text-gray-400 elsa-text-sm"},e)):void 0}renderNetworkError(){if(this.networkError)return s("div",null,s("span",{class:"elsa-text-rose-400 elsa-text-sm"},"An error occurred: ",this.networkError))}renderPublishButton(){return s("elsa-workflow-publish-button",{publishing:this.publishing,workflowDefinition:this.workflowDefinition,onPublishClicked:()=>this.onPublishClicked(),onUnPublishClicked:()=>this.onUnPublishClicked(),onExportClicked:()=>this.onExportClicked(),onImportClicked:t=>this.onImportClicked(t.detail),culture:this.culture})}static createWorkflowDefinition(){return{definitionId:null,version:1,activities:[],connections:[],persistenceBehavior:n.WorkflowBurst}}renderPropertiesPanel(){return s("elsa-flyout-panel",{expandButtonPosition:2},s("elsa-tab-header",{tab:"general",slot:"header"},"General"),s("elsa-tab-content",{tab:"general",slot:"content"},s("elsa-workflow-properties-panel",{workflowDefinition:this.workflowDefinition})))}static get watchers(){return{workflowDefinitionId:["workflowDefinitionIdChangedHandler"],serverUrl:["serverUrlChangedHandler"],monacoLibPath:["monacoLibPathChangedHandler"]}}};a(y),d.injectProps(y,["serverUrl","culture","monacoLibPath"]);export{y as elsa_workflow_definition_editor_screen}
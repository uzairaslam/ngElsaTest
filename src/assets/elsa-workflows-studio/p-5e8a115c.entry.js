import{r as e,h as t,H as s}from"./p-d44d1ddb.js";import{c as r}from"./p-a3b5bd35.js";import{a as o,S as a}from"./p-25ed19bb.js";import{a as i}from"./p-bdae1cb5.js";import"./p-4bdcf3f8.js";import{s as n}from"./p-c550dea5.js";import{W as l}from"./p-dc36c952.js";import{T as d}from"./p-151ebb97.js";import"./p-80de33dc.js";import"./p-e47f7c7d.js";import"./p-f90ae5bc.js";import"./p-d17a08e5.js";import"./p-83f217d4.js";const p=class{constructor(t){e(this,t)}async getServerUrl(){return this.serverUrl}async workflowDefinitionIdChangedHandler(e){const t=e;let s={id:null,version:1,activities:[],connections:[],persistenceBehavior:o.WorkflowBurst,customAttributes:{data:{}},persistWorkflow:!1,isLatest:!1,isPublished:!1,loadWorkflowContext:!1,isSingleton:!1,saveWorkflowContext:!1,variables:{data:{}},type:null,inputProperties:{data:{}},outputProperties:{data:{}},propertyStorageProviders:{}};const r=await i(this.serverUrl);if(t&&t.length>0)try{s=await r.workflowRegistryApi.get(t,{isLatest:!0})}catch(e){console.warn("The specified workflow blueprint does not exist. Creating a new one.")}this.updateModels(s)}async serverUrlChangedHandler(e){e&&e.length>0&&await this.loadActivityDescriptors()}async componentWillLoad(){await this.serverUrlChangedHandler(this.serverUrl),await this.workflowDefinitionIdChangedHandler(this.workflowDefinitionId)}componentDidLoad(){this.designer||(this.designer=this.el.querySelector("elsa-designer-tree"),this.designer.model=this.workflowModel)}async loadActivityDescriptors(){const e=await i(this.serverUrl);n.activityDescriptors=await e.activitiesApi.list()}updateModels(e){this.workflowBlueprint=e,this.workflowModel=this.mapWorkflowModel(e)}mapWorkflowModel(e){return{activities:e.activities.filter((t=>t.parentId==e.id||!t.parentId)).map(this.mapActivityModel),connections:e.connections.map(this.mapConnectionModel),persistenceBehavior:e.persistenceBehavior}}mapActivityModel(e){const t=n.activityDescriptors.find((t=>t.type==e.type)),s=r.map(e.inputProperties.data,((e,s)=>{const r=t.inputProperties.find((e=>e.name==s)).defaultSyntax||a.Literal,o={};return o[r]=e,{name:s,expressions:o,syntax:r}}));return{activityId:e.id,description:e.description,displayName:e.displayName||e.name||e.type,name:e.name,type:e.type,properties:s,outcomes:[...t.outcomes],persistWorkflow:e.persistWorkflow,saveWorkflowContext:e.saveWorkflowContext,loadWorkflowContext:e.loadWorkflowContext,propertyStorageProviders:e.propertyStorageProviders}}mapConnectionModel(e){return{sourceId:e.sourceActivityId,targetId:e.targetActivityId,outcome:e.outcome}}render(){return t(s,{class:"elsa-flex elsa-flex-col elsa-w-full elsa-relative",ref:e=>this.el=e},this.renderCanvas())}renderCanvas(){return t("div",{class:"elsa-flex-1 elsa-flex"},t("elsa-designer-tree",{model:this.workflowModel,class:"elsa-flex-1",ref:e=>this.designer=e,mode:l.Blueprint}),t("elsa-flyout-panel",null,t("elsa-tab-header",{tab:"general",slot:"header"},"General"),t("elsa-tab-content",{tab:"general",slot:"content"},t("elsa-workflow-blueprint-side-panel",{workflowId:this.workflowDefinitionId}))))}static get watchers(){return{workflowDefinitionId:["workflowDefinitionIdChangedHandler"],serverUrl:["serverUrlChangedHandler"]}}};d.injectProps(p,["serverUrl","culture"]);export{p as elsa_workflow_blueprint_viewer_screen}
import{r as e,h as s,H as a}from"./p-d44d1ddb.js";import{e as l}from"./p-d17a08e5.js";import{E as t}from"./p-866503d3.js";import{c as i}from"./p-301ee725.js";import{F as o,t as n,a as r,c as d}from"./p-c967242a.js";import{T as h}from"./p-151ebb97.js";import"./p-e47f7c7d.js";import"./p-f90ae5bc.js";import"./p-25ed19bb.js";import"./p-83f217d4.js";const c=class{constructor(s){e(this,s)}async getServerUrl(){return this.serverUrl}async getWebhookId(){return this.webhookDefinitionInternal.id}async webhookDefinitionChangedHandler(e){this.webhookDefinitionInternal=Object.assign({},e),this.formContext=new o(this.webhookDefinitionInternal,(e=>this.webhookDefinitionInternal=e))}async webhookIdChangedHandler(e){const s=e;let a=c.createWebhookDefinition();a.id=s;const l=i(this.serverUrl);if(s&&s.length>0)try{a=await l.webhookDefinitionsApi.getByWebhookId(s)}catch(e){console.warn("The specified webhook definition does not exist. Creating a new one.")}else a.isEnabled=!0;this.updateWebhookDefinition(a)}async serverUrlChangedHandler(e){}async componentWillLoad(){await this.serverUrlChangedHandler(this.serverUrl),await this.webhookDefinitionChangedHandler(this.webhookDefinition),await this.webhookIdChangedHandler(this.webhookId)}async saveWebhook(){if(!this.serverUrl||0==this.serverUrl.length)return;const e=i(this.serverUrl);let s=this.webhookDefinitionInternal;const a={id:s.id||this.webhookId,name:s.name,path:s.path,description:s.description,payloadTypeName:s.payloadTypeName,isEnabled:s.isEnabled};this.saving=!0;try{s=null==a.id?await e.webhookDefinitionsApi.save(a):await e.webhookDefinitionsApi.update(a),this.saving=!1,this.saved=!0,setTimeout((()=>this.saved=!1),500)}catch(e){console.error(e),this.saving=!1,this.saved=!1,this.networkError=e.message,setTimeout((()=>this.networkError=null),1e4)}}updateWebhookDefinition(e){this.webhookDefinition=e}sleep(e){return new Promise((s=>setTimeout(s,e)))}navigate(e){this.history?this.history.push(e):document.location.pathname=e}async onSaveClicked(e){e.preventDefault(),await this.saveWebhook(),l.emit(t.WebhookSaved,this,this.webhookDefinitionInternal),this.sleep(1e3).then((()=>{this.navigate("/webhook-definitions")}))}render(){return s(a,{class:"elsa-flex elsa-flex-col elsa-w-full",ref:e=>this.el=e},s("form",{onSubmit:e=>this.onSaveClicked(e)},s("div",{class:"elsa-px-8 mb-8"},s("div",{class:"elsa-border-b elsa-border-gray-200"})),this.renderWebhookFields(),this.renderCanvas()))}renderWebhookFields(){const e=this.webhookDefinitionInternal,a=this.formContext;return s("main",{class:"elsa-max-w-7xl elsa-mx-auto elsa-pb-10 lg:elsa-py-12 lg:elsa-px-8"},s("div",{class:"lg:elsa-grid lg:elsa-grid-cols-12 lg:elsa-gap-x-5"},s("aside",{class:"elsa-py-6 elsa-px-2 sm:elsa-px-6 lg:elsa-py-0 lg:elsa-px-0 lg:elsa-col-span-2"}),s("div",{class:"elsa-space-y-6 sm:elsa-px-6 lg:elsa-px-0 lg:elsa-col-span-9"},s("section",{"aria-labelledby":"payment_details_heading"},s("div",{class:"elsa-shadow sm:elsa-rounded-md sm:elsa-overflow-hidden"},s("div",{class:"elsa-bg-white elsa-py-6 elsa-px-4 sm:elsa-p-6"},s("div",null,s("h1",{class:"elsa-text-lg elsa-leading-6 elsa-font-medium elsa-text-gray-900"},null==e.id?"Create Webhook Definition":"Edit Webhook Definition")),s("div",{class:"elsa-mt-6 elsa-grid elsa-grid-cols-4 elsa-gap-6"},s("div",{class:"elsa-col-span-4"},n(a,"name","Name",e.name,"The name of the webhook.","webhookName")),s("div",{class:"elsa-col-span-4"},n(a,"path","Path",e.path,"The path of the webhook.","webhookPath")),s("div",{class:"elsa-col-span-4"},r(a,"description","Description",e.description,null,"webhookDescription")),s("div",{class:"elsa-col-span-4"},n(a,"payloadTypeName","Payload Type Name",e.payloadTypeName,"The payload type name of the webhook.","webhookPayloadTypeName")),s("div",{class:"elsa-col-span-4"},d(a,"isEnabled","Enabled",e.isEnabled,null)))),s("div",{class:"elsa-px-4 elsa-py-3 elsa-bg-gray-50 elsa-text-right sm:px-6"},s("button",{type:"submit",class:"elsa-ml-0 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-transparent elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-blue-600 elsa-text-base elsa-font-medium elsa-text-white hover:elsa-bg-blue-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm"},"Save")))))))}renderCanvas(){return s("div",{class:"elsa-flex-1 elsa-flex elsa-relative"},s("elsa-webhook-definition-editor-notifications",null),s("div",{class:"elsa-fixed elsa-bottom-10 elsa-right-12"},s("div",{class:"elsa-flex elsa-items-center elsa-space-x-4"},this.renderSavingIndicator(),this.renderNetworkError())))}renderSavingIndicator(){const e=this.saving?"Saving...":this.saved?"Saved":null;if(e)return s("div",null,s("span",{class:"elsa-text-gray-400 elsa-text-sm"},e))}renderNetworkError(){if(this.networkError)return s("div",null,s("span",{class:"elsa-text-rose-400 elsa-text-sm"},"An error occurred: ",this.networkError))}static createWebhookDefinition(){return{id:null}}static get watchers(){return{webhookDefinition:["webhookDefinitionChangedHandler"],webhookId:["webhookIdChangedHandler"],serverUrl:["serverUrlChangedHandler"]}}};h.injectProps(c,["serverUrl","culture"]);export{c as elsa_webhook_definition_editor_screen}
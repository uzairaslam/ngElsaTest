import{r as e,c as s,h as a,H as l}from"./p-d44d1ddb.js";import{c as t}from"./p-a3b5bd35.js";import{h as i}from"./p-e4caa342.js";import{a as n}from"./p-f6467a51.js";import{a as r}from"./p-bdae1cb5.js";import{d,c}from"./p-4bdcf3f8.js";import"./p-80de33dc.js";import"./p-e47f7c7d.js";import"./p-f90ae5bc.js";import"./p-d17a08e5.js";import"./p-25ed19bb.js";const o=class{constructor(l){e(this,l),this.recordSelected=s(this,"recordSelected",7),this.activityDescriptors=[],this.isVisible=!0,this.records={items:[],totalCount:0},this.filteredRecords=[],this.selectedTabId="journal",this.renderJournalTab=()=>{const e=this.filteredRecords,s=this.activityDescriptors,l=this.workflowBlueprint.activities||[],r=this.selectedRecordId;return a("div",{class:"flow-root elsa-mt-4"},a("ul",{class:"-elsa-mb-8"},e.map(((o,m)=>{const u=m==e.length-1,x=u?null:e[m+1],f=i(o.timestamp),y=u?null:i(x.timestamp),p=u?null:i.duration(y.diff(f)),g=o.activityType,b=n.getIcon(g),h=s.find((e=>e.type===g)),v=l.find((e=>e.id===o.activityId))||{name:null,displayName:null},w=v.displayName||v.name||h.displayName||h.type,j=o.eventName,k=this.getEventColor(j),I=o.id===r?"elsa-border-blue-600":"hover:elsa-bg-gray-100 elsa-border-transparent",C=o.data||{},E={},S={State:!0,Input:null,Outcomes:!0,Exception:!0};for(const e in C){if(!C.hasOwnProperty(e))continue;if(S[e])continue;const s=C[e];if(!s&&0!=s)continue;let a=null;a="string"==typeof s?s:"object"==typeof s?JSON.stringify(s,null,1):void 0===s?null:s.toString(),E[e]=a}const H=d(p),Y=C.Outcomes&&C.Outcomes||[],A=C.Exception?C.Exception:null,N=e=>a("div",null,a("div",{class:"elsa-mb-4"},a("strong",{class:"elsa-block elsa-font-bold"},e.Type),e.Message),e.InnerException?a("div",{class:"elsa-ml-4"},N(e.InnerException)):void 0);return a("li",null,a("div",{onClick:()=>this.onRecordClick(o),class:`${I} elsa-border-2 elsa-cursor-pointer elsa-p-4 elsa-rounded`},a("div",{class:"elsa-relative elsa-pb-10"},u?void 0:a("div",{class:"elsa-flex elsa-absolute top-8 elsa-left-4 -elsa-ml-px elsa-h-full elsa-w-0.5"},a("div",{class:"elsa-flex elsa-flex-1 elsa-items-center elsa-relative elsa-right-10"},a("span",{class:"elsa-flex-1 elsa-text-sm elsa-text-gray-500 elsa-w-max elsa-bg-white elsa-p-1 elsa-rounded"},H))),a("div",{class:"elsa-relative elsa-flex elsa-space-x-3"},a("div",null,a("span",{class:"elsa-h-8 elsa-w-8 elsa-rounded-full elsa-bg-green-500 elsa-flex elsa-items-center elsa-justify-center elsa-ring-8 elsa-ring-white",innerHTML:b})),a("div",{class:"elsa-min-w-0 elsa-flex-1 elsa-pt-1.5 elsa-flex elsa-justify-between elsa-space-x-4"},a("div",null,a("h3",{class:"elsa-text-lg elsa-leading-6 elsa-font-medium elsa-text-gray-900"},w)),a("div",null,a("span",{class:"elsa-relative elsa-inline-flex elsa-items-center elsa-rounded-full elsa-border elsa-border-gray-300 elsa-px-3 elsa-py-0.5 elsa-text-sm"},a("span",{class:"elsa-absolute elsa-flex-shrink-0 elsa-flex elsa-items-center elsa-justify-center"},a("span",{class:`elsa-h-1.5 elsa-w-1.5 elsa-rounded-full elsa-bg-${k}-500`,"aria-hidden":"true"})),a("span",{class:"elsa-ml-3.5 elsa-font-medium elsa-text-gray-900"},j))),a("div",{class:"elsa-text-right elsa-text-sm elsa-whitespace-nowrap elsa-text-gray-500"},a("span",null,f.format("DD-MM-YYYY HH:mm:ss"))))),a("div",{class:"elsa-ml-12 elsa-mt-2"},a("dl",{class:"sm:elsa-divide-y sm:elsa-divide-gray-200"},a("div",{class:"elsa-grid elsa-grid-cols-2 elsa-gap-x-4 elsa-gap-y-8 sm:elsa-grid-cols-2"},a("div",{class:"sm:elsa-col-span-2"},a("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Activity ID"),a("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-mb-2"},o.activityId)),Y.length>0?a("div",{class:"sm:elsa-col-span-2"},a("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Outcomes"),a("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-mb-2"},a("div",{class:"elsa-flex elsa-flex-col elsa-space-y-4 sm:elsa-space-y-0 sm:elsa-flex-row sm:elsa-space-x-4"},Y.map((e=>a("span",{class:"elsa-inline-flex elsa-items-center elsa-px-3 elsa-py-0.5 elsa-rounded-full elsa-text-sm elsa-font-medium elsa-bg-blue-100 elsa-text-blue-800"},e)))))):void 0,o.message&&!A?a("div",{class:"sm:elsa-col-span-2"},a("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Message"),a("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900"},o.message)):void 0,A?[a("div",{class:"sm:elsa-col-span-2"},a("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Exception"),a("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900"},N(A))),a("div",{class:"sm:elsa-col-span-2"},a("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Exception Details"),a("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-overflow-x-auto"},a("pre",{onClick:e=>c(e.currentTarget)},JSON.stringify(A,null,1))))]:void 0,t.map(E,((e,s)=>a("div",{class:"sm:elsa-col-span-2"},a("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500 elsa-capitalize"},s),a("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-mb-2 elsa-overflow-x-auto"},a("pre",{onClick:e=>c(e.currentTarget)},e)))))))))))}))))},this.renderActivityStateTab=()=>{const e=this.workflowModel&&this.selectedActivityId?this.workflowModel.activities.find((e=>e.activityId===this.selectedActivityId)):null;if(!e)return a("p",null,"No activity selected");const s=Object.assign(Object.assign({},e),{properties:e.properties.map((e=>({name:e.name,value:e.value})))});return a("div",{class:"elsa-mt-4"},a("pre",null,JSON.stringify(s,null,2)))},this.renderGeneralTab=()=>{const{workflowInstance:e,workflowBlueprint:s}=this,{finishedAt:l,lastExecutedAt:t,faultedAt:n}=e,r="DD-MM-YYYY HH:mm:ss";return a("dl",{class:"elsa-border-b elsa-border-gray-200 elsa-divide-y elsa-divide-gray-200"},a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Workflow Name"),a("dd",{class:"elsa-text-gray-900"},s.name)),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Instance Name"),a("dd",{class:"elsa-text-gray-900"},e.name||"-")),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Id"),a("dd",{class:"elsa-text-gray-900"},e.id)),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Correlation id"),a("dd",{class:"elsa-text-gray-900"},e.correlationId)),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Version"),a("dd",{class:"elsa-text-gray-900 elsa-break-all"},e.version||"-")),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Workflow Status"),a("dd",{class:"elsa-text-gray-900 elsa-break-all"},e.workflowStatus||"-")),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Created"),a("dd",{class:"elsa-text-gray-900 elsa-break-all"},i(e.createdAt).format(r)||"-")),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Finished"),a("dd",{class:"elsa-text-gray-900 elsa-break-all"},l?i(l).format(r):"-")),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Last Executed"),a("dd",{class:"elsa-text-gray-900 elsa-break-all"},t?i(t).format(r):"-")),a("div",{class:"elsa-py-3 elsa-flex elsa-justify-between elsa-text-sm elsa-font-medium"},a("dt",{class:"elsa-text-gray-500"},"Faulted"),a("dd",{class:"elsa-text-gray-900 elsa-break-all"},n?i(n).format(r):"-")))}}async selectActivityRecord(e){const s=e?this.filteredRecords.find((s=>s.activityId==e)):null;this.selectActivityRecordInternal(s),await this.flyoutPanel.selectTab("journal",!0)}async workflowInstanceIdChangedHandler(e){const s=e,a=await r(this.serverUrl);if(s&&s.length>0)try{this.records=await a.workflowExecutionLogApi.get(s),this.filteredRecords=this.records.items.filter((e=>"Executing"!=e.eventName&&"Resuming"!=e.eventName))}catch(e){console.warn("The specified workflow instance does not exist.")}}async componentWillLoad(){await this.workflowInstanceIdChangedHandler(this.workflowInstanceId)}selectActivityRecordInternal(e){const s=e?this.workflowBlueprint.activities.find((s=>s.id===e.activityId)):null;this.selectedRecordId=e?e.id:null,this.selectedActivityId=null!=s?s.parentId&&s.parentId!=this.workflowBlueprint.id?s.parentId:s.id:null}getEventColor(e){return{Executing:"blue",Executed:"green",Faulted:"rose",Warning:"yellow",Information:"blue"}[e]||"gray"}onRecordClick(e){this.selectActivityRecordInternal(e),this.recordSelected.emit(e)}onTabClick(e,s){e.preventDefault(),this.selectedTabId=s.id}render(){return a(l,null,this.renderPanel())}renderPanel(){return a("elsa-flyout-panel",{ref:e=>this.flyoutPanel=e},a("elsa-tab-header",{tab:"general",slot:"header"},"General"),a("elsa-tab-content",{tab:"general",slot:"content"},this.renderGeneralTab()),a("elsa-tab-header",{tab:"journal",slot:"header"},"Journal"),a("elsa-tab-content",{tab:"journal",slot:"content"},this.renderJournalTab()),a("elsa-tab-header",{tab:"activityState",slot:"header"},"Activity State"),a("elsa-tab-content",{tab:"activityState",slot:"content"},this.renderActivityStateTab()))}static get watchers(){return{workflowInstanceId:["workflowInstanceIdChangedHandler"]}}};export{o as elsa_workflow_instance_journal}
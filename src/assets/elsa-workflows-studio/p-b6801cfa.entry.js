import{r as e,h as s,H as t}from"./p-d44d1ddb.js";import{e as a}from"./p-d17a08e5.js";import{c as l}from"./p-a3b5bd35.js";import{b as i,a as r,S as n}from"./p-25ed19bb.js";import{E as o}from"./p-f90ae5bc.js";import{a as c}from"./p-bdae1cb5.js";import{s as d}from"./p-c550dea5.js";import{W as h}from"./p-dc36c952.js";import{r as x}from"./p-dfca8bd9.js";import{h as u}from"./p-e4caa342.js";import{c as p,d as y}from"./p-4bdcf3f8.js";import{T as m}from"./p-151ebb97.js";import"./p-80de33dc.js";import"./p-e47f7c7d.js";import"./p-83f217d4.js";const v=class{constructor(t){e(this,t),this.activityContextMenuState={shown:!1,x:0,y:0,activity:null},this.getActivityBorderColor=e=>{const s=this.workflowInstance,t=s?s.fault:null,a=(s.activityData[e.activityId]||{})._Lifecycle||{};return t&&t.faultedActivityId==e.activityId?"red":a.executed?"green":a.executing?"blue":null},this.renderActivityStatsButton=e=>{const s=this.workflowInstance,t=s?s.fault:null,a=(s.activityData[e.activityId]||{})._Lifecycle||{};let l;return l=t&&t.faultedActivityId==e.activityId?'<svg class="elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-red-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10"/>\n                <line x1="12" y1="8" x2="12" y2="12"/>\n                <line x1="12" y1="16" x2="12.01" y2="16"/>\n              </svg>':a.executed?'<svg class="elsa-h-6 elsa-w-6 elsa-text-green-500"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10" />\n                <line x1="12" y1="16" x2="12" y2="12" />\n                <line x1="12" y1="8" x2="12.01" y2="8" />\n              </svg>':a.executing?'<svg class="elsa-h-6 elsa-w-6 elsa-text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10" />\n                <line x1="12" y1="16" x2="12" y2="12" />\n                <line x1="12" y1="8" x2="12.01" y2="8" />\n              </svg>':'<svg class="h-6 w-6 text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10" />\n                <line x1="12" y1="16" x2="12" y2="12" />\n                <line x1="12" y1="8" x2="12.01" y2="8" />\n              </svg>',`<div class="context-menu-wrapper elsa-flex-shrink-0">\n            <button aria-haspopup="true"\n                    class="elsa-w-8 elsa-h-8 elsa-inline-flex elsa-items-center elsa-justify-center elsa-text-gray-400 elsa-rounded-full elsa-bg-transparent hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-text-gray-500 focus:elsa-bg-gray-100 elsa-transition elsa-ease-in-out elsa-duration-150">\n              ${l}\n            </button>\n          </div>`},this.renderActivityPerformanceMenu=()=>{const e=this.activityStats;return s("div",{"data-transition-enter":"elsa-transition elsa-ease-out elsa-duration-100","data-transition-enter-start":"elsa-transform elsa-opacity-0 elsa-scale-95","data-transition-enter-end":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave":"elsa-transition elsa-ease-in elsa-duration-75","data-transition-leave-start":"elsa-transform elsa-opacity-100 elsa-scale-100","data-transition-leave-end":"elsa-transform elsa-opacity-0 elsa-scale-95",class:(this.activityContextMenuState.shown?"":"hidden")+" elsa-absolute elsa-z-10 elsa-mt-3 elsa-px-2 elsa-w-screen elsa-max-w-xl sm:elsa-px-0",style:{left:`${this.activityContextMenuState.x+64}px`,top:this.activityContextMenuState.y-256+"px"},ref:e=>x(this,e,(()=>{this.handleContextMenuChange(0,0,!1,null)}))},s("div",{class:"elsa-rounded-lg elsa-shadow-lg elsa-ring-1 elsa-ring-black elsa-ring-opacity-5 elsa-overflow-hidden"},e?s("div",null,s("div",null,s("table",{class:"elsa-min-w-full elsa-divide-y elsa-divide-gray-200 elsa-border-b elsa-border-gray-200"},s("thead",{class:"elsa-bg-gray-50"},s("tr",null,s("th",{scope:"col",class:"elsa-px-6 elsa-py-3 elsa-text-left elsa-text-xs elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-tracking-wider"},"Event"),s("th",{scope:"col",class:"elsa-px-6 elsa-py-3 elsa-text-left elsa-text-xs elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-tracking-wider"},"Count"))),s("tbody",{class:"elsa-bg-white elsa-divide-y elsa-divide-gray-200"},e.eventCounts.length>0?e.eventCounts.map((e=>s("tr",null,s("td",{class:"elsa-px-6 elsa-py-4 elsa-whitespace-nowrap elsa-text-sm elsa-font-medium elsa-text-gray-900"},e.eventName),s("td",{class:"elsa-px-6 elsa-py-4 elsa-whitespace-nowrap elsa-text-sm elsa-text-gray-500"},e.count)))):s("tr",null,s("td",{colSpan:2,class:"elsa-px-6 elsa-py-4 elsa-whitespace-nowrap elsa-text-sm elsa-font-medium elsa-text-gray-900"},"No events record for this activity."))))),e.eventCounts.length>0?s("div",{class:"elsa-relative elsa-grid elsa-gap-6 elsa-bg-white px-5 elsa-py-6 sm:elsa-gap-8 sm:elsa-p-8"},(()=>{if(!e.fault)return;const t=this.workflowInstance.fault,a=e=>s("div",null,s("div",{class:"elsa-mb-4"},s("strong",{class:"elsa-block elsa-font-bold"},e.type),e.message),e.innerException?s("div",{class:"elsa-ml-4"},a(e.innerException)):void 0);return[s("div",{class:"-elsa-m-3 elsa-p-3 elsa-flex elsa-items-start elsa-rounded-lg hover:elsa-bg-gray-50 elsa-transition elsa-ease-in-out elsa-duration-150"},s("svg",{class:"elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-red-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},s("circle",{cx:"12",cy:"12",r:"10"}),s("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),s("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})),s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},"Fault"),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},a(t.exception),s("pre",{class:"elsa-overflow-x-scroll elsa-max-w-md",onClick:e=>p(e.currentTarget)},JSON.stringify(t,null,1))))),s("a",{href:"#",class:"-elsa-m-3 elsa-p-3 elsa-flex elsa-items-start elsa-rounded-lg hover:elsa-bg-gray-50 elsa-transition elsa-ease-in-out elsa-duration-150"},s("svg",{class:"elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-blue-600",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("rect",{x:"4",y:"5",width:"16",height:"16",rx:"2"}),s("line",{x1:"16",y1:"3",x2:"16",y2:"7"}),s("line",{x1:"8",y1:"3",x2:"8",y2:"7"}),s("line",{x1:"4",y1:"11",x2:"20",y2:"11"}),s("line",{x1:"11",y1:"15",x2:"12",y2:"15"}),s("line",{x1:"12",y1:"15",x2:"12",y2:"18"})),s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},"Faulted At"),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},u(this.workflowInstance.faultedAt).format("DD-MM-YYYY HH:mm:ss"))))]})(),(()=>{if(!e.fault)return[s("a",{href:"#",class:"-elsa-m-3 elsa-p-3 elsa-flex elsa-items-start elsa-rounded-lg hover:elsa-bg-gray-50 elsa-transition elsa-ease-in-out elsa-duration-150"},s("svg",{class:"elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-indigo-500",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("circle",{cx:"12",cy:"12",r:"9"}),s("polyline",{points:"12 7 12 12 15 15"})),s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},"Average Execution Time"),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},y(u.duration(e.averageExecutionTime))))),s("a",{href:"#",class:"-m-3 elsa-p-3 elsa-flex elsa-items-start elsa-rounded-lg hover:elsa-bg-gray-50 elsa-transition elsa-ease-in-out elsa-duration-150"},s("svg",{class:"elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-green-500",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("circle",{cx:"12",cy:"12",r:"9"}),s("polyline",{points:"12 7 12 12 15 15"})),s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},"Fastest Execution Time"),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},y(u.duration(e.fastestExecutionTime))))),s("a",{href:"#",class:"-elsa-m-3 elsa-p-3 elsa-flex elsa-items-start elsa-rounded-lg hover:elsa-bg-gray-50 elsa-transition elsa-ease-in-out elsa-duration-150"},s("svg",{class:"elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-yellow-500",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("circle",{cx:"12",cy:"12",r:"9"}),s("polyline",{points:"12 7 12 12 15 15"})),s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},"Slowest Execution Time"),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},y(u.duration(e.slowestExecutionTime))))),s("a",{href:"#",class:"-elsa-m-3 elsa-p-3 elsa-flex elsa-items-start elsa-rounded-lg hover:elsa-bg-gray-50 elsa-transition elsa-ease-in-out elsa-duration-150"},s("svg",{class:"elsa-flex-shrink-0 elsa-h-6 elsa-w-6 elsa-text-blue-600",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},s("path",{stroke:"none",d:"M0 0h24v24H0z"}),s("rect",{x:"4",y:"5",width:"16",height:"16",rx:"2"}),s("line",{x1:"16",y1:"3",x2:"16",y2:"7"}),s("line",{x1:"8",y1:"3",x2:"8",y2:"7"}),s("line",{x1:"4",y1:"11",x2:"20",y2:"11"}),s("line",{x1:"11",y1:"15",x2:"12",y2:"15"}),s("line",{x1:"12",y1:"15",x2:"12",y2:"18"})),s("div",{class:"elsa-ml-4"},s("p",{class:"elsa-text-base elsa-font-medium elsa-text-gray-900"},"Last Executed At"),s("p",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-500"},u(e.lastExecutedAt).format("DD-MM-YYYY HH:mm:ss"))))]})()):void 0):s("div",{class:"elsa-p-6 elsa-bg-white"},"Loading...")))}}async getServerUrl(){return this.serverUrl}async workflowInstanceIdChangedHandler(e){const s=e;let t={id:null,definitionId:null,version:null,workflowStatus:i.Idle,variables:{data:{}},blockingActivities:[],scheduledActivities:[],scopes:[],currentActivity:{activityId:""}},a={id:null,version:1,activities:[],connections:[],persistenceBehavior:r.WorkflowBurst,customAttributes:{data:{}},persistWorkflow:!1,isLatest:!1,isPublished:!1,loadWorkflowContext:!1,isSingleton:!1,saveWorkflowContext:!1,variables:{data:{}},type:null,inputProperties:{data:{}},outputProperties:{data:{}},propertyStorageProviders:{}};const l=await c(this.serverUrl);if(s&&s.length>0)try{t=await l.workflowInstancesApi.get(s),a=await l.workflowRegistryApi.get(t.definitionId,{version:t.version})}catch(e){console.warn("The specified workflow definition does not exist. Creating a new one.")}this.updateModels(t,a)}async serverUrlChangedHandler(e){e&&e.length>0&&await this.loadActivityDescriptors()}async componentWillLoad(){await this.serverUrlChangedHandler(this.serverUrl),await this.workflowInstanceIdChangedHandler(this.workflowInstanceId)}componentDidLoad(){this.designer||(this.designer=this.el.querySelector("elsa-designer-tree"),this.designer.model=this.workflowModel)}async loadActivityDescriptors(){const e=await c(this.serverUrl);d.activityDescriptors=await e.activitiesApi.list()}updateModels(e,s){this.workflowInstance=e,this.workflowBlueprint=s,this.workflowModel=this.mapWorkflowModel(s,e)}mapWorkflowModel(e,s){const t=e.activities.filter((s=>s.parentId==e.id||!s.parentId)).map((e=>this.mapActivityModel(e,s))),a=e.connections.filter((e=>t.findIndex((s=>s.activityId==e.sourceActivityId||s.activityId==e.targetActivityId))>-1)).map(this.mapConnectionModel);return{activities:t,connections:a,persistenceBehavior:e.persistenceBehavior}}mapActivityModel(e,s){const t=d.activityDescriptors.find((s=>s.type==e.type)),a=s.activityData[e.id]||{},i=l.map(e.inputProperties.data,((e,s)=>{const l=(t.inputProperties.find((e=>e.name==s))||t.outputProperties.find((e=>e.name==s))).defaultSyntax||n.Literal,i={},r=a[s]||e;return i[l]=r,{name:s,value:r,expressions:i,syntax:l}}));return{activityId:e.id,description:e.description,displayName:e.displayName||e.name||e.type,name:e.name,type:e.type,properties:i,outcomes:[...t.outcomes],persistWorkflow:e.persistWorkflow,saveWorkflowContext:e.saveWorkflowContext,loadWorkflowContext:e.loadWorkflowContext,propertyStorageProviders:e.propertyStorageProviders}}mapConnectionModel(e){return{sourceId:e.sourceActivityId,targetId:e.targetActivityId,outcome:e.outcome}}handleContextMenuChange(e,s,t,a){this.activityContextMenuState={shown:t,x:e,y:s,activity:a}}onShowWorkflowSettingsClick(){a.emit(o.ShowWorkflowSettings)}onRecordSelected(e){const s=e.detail,t=s?this.workflowBlueprint.activities.find((e=>e.id===s.activityId)):null;this.selectedActivityId=null!=t?null!=t.parentId?t.parentId:t.id:null}async onActivitySelected(e){this.selectedActivityId=e.detail.activityId,await this.journal.selectActivityRecord(this.selectedActivityId)}async onActivityDeselected(e){this.selectedActivityId==e.detail.activityId&&(this.selectedActivityId=null),await this.journal.selectActivityRecord(this.selectedActivityId)}async onActivityContextMenuButtonClicked(e){if(this.activityContextMenuState=e.detail,this.activityStats=null,!e.detail.shown)return;const s=await c(this.serverUrl);this.activityStats=await s.activityStatsApi.get(this.workflowInstanceId,e.detail.activity.activityId)}render(){const e=d.activityDescriptors;return s(t,{class:"elsa-flex elsa-flex-col elsa-w-full elsa-relative",ref:e=>this.el=e},this.renderCanvas(),s("elsa-workflow-instance-journal",{ref:e=>this.journal=e,workflowInstanceId:this.workflowInstanceId,workflowInstance:this.workflowInstance,serverUrl:this.serverUrl,activityDescriptors:e,workflowBlueprint:this.workflowBlueprint,workflowModel:this.workflowModel,onRecordSelected:e=>this.onRecordSelected(e)}))}renderCanvas(){return s("div",{class:"elsa-flex-1 elsa-flex"},s("elsa-designer-tree",{model:this.workflowModel,class:"elsa-flex-1",ref:e=>this.designer=e,mode:h.Instance,activityContextMenuButton:this.renderActivityStatsButton,activityBorderColor:this.getActivityBorderColor,activityContextMenu:this.activityContextMenuState,selectedActivityIds:[this.selectedActivityId],onActivitySelected:e=>this.onActivitySelected(e),onActivityDeselected:e=>this.onActivityDeselected(e),onActivityContextMenuButtonClicked:e=>this.onActivityContextMenuButtonClicked(e)}),this.renderActivityPerformanceMenu())}static get watchers(){return{workflowInstanceId:["workflowInstanceIdChangedHandler"],serverUrl:["serverUrlChangedHandler"]}}};m.injectProps(v,["serverUrl","culture"]);export{v as elsa_workflow_instance_viewer_screen}